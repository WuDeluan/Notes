# Servlet

## Servlet基础

#### * servlet是什么

> 其实就是一个Java程序,运行在web服务器上,用于接收和响应客户端的http请求.<br>
 更多的是配合动态资源来做.当静态资源也需要使用带servlet,只不过是Tomcat里面已经定义好的一个DefaultServlet.

### Hello Servlet
1.写一个web工程,要有一个服务器<br>
2.测试运行web工程
```xml
        1.创建一个类,实现servlet接口
        2.配置servlet,用意 : 告诉服务器,我们的引用有这么些个servlet
        
            再webContent/WEB-INF/web.xml里卖弄写下以下内容.
            
              <!--   向tomcat报告，引用里面有一个servlet,名字叫做HelloServlet,具体的路径是com.firstweb.HelloServelet -->
              <servlet>
                   <servlet-name>HelloServlet</servlet-name>
                   <servlet-class>com.firstweb.HelloServelet</servlet-class>
              </servlet>

              <!--   注册servlet的映射，servletName : 找到赏面注册的具体servlet,url-pattern : 在地址栏上的path,一定要以/打头 -->
              <servlet-mapping>
                    <servlet-name>HelloServlet</servlet-name>
                    <url-pattern>/hello</url-pattern>
              </servlet-mapping>
         3.在地址栏上输入http://localhost:8080/项目名称
```

### Servlet执行过程

  ![icon](https://github.com/WuDeluan/Notes/blob/master/picture/servlet1.PNG)

### Servlet通用写法
          Servlet (接口)
              |
              |
        GenericServlet
              |
              |
         HttpServlet (用于处理http的请求)
 1.定义一个类,继承HttpServlet,复写doGet和doPost<br>
 
  ![icon](https://github.com/WuDeluan/Notes/blob/master/picture/servlet2.PNG)
 

### Servlet的生命周期
* 生命周期
> 从创建到销毁的一段时间
* 生命周期方法
> 从创建到销毁所调用的那些方法

* 主要方法
  * init方法
    ``` 
      1.在创建该Servlet的是历史,就执行该方法
      2.一个servle只会初始化一次init方法
      3.默认情况下,初次访问该servlet才会创建实例
     ```
     
  * service方法
     ```
       1.只要客户端来了一个请求,那么就执行一次该方法
       2.该方法可以被执行多次
     ```
  * destory方法
     ```
       1.servlet销毁的时候,就会执行该方法
           ①该项目冲tomcat里里面移出
           ②正常关闭tomcat就会执行shutdown.bat
     ```
>doGet和doPost不算生命周期方法,所谓生命周期方法是指,冲对象的创建到销毁一定会执行的方法,但是这两个方法不一定会被执行.

### 让servlet创建实例的时机提前

1.默认情况下,只有在初次访问servlet的时候,才会执行init方法,有时候我们可能需要在这个方法里执行一些初始化工作,甚至是做一些比较耗时的逻辑.
2.那么这个时候,初次访问,可能会在init方法中逗留较旧的时间,所以需要使初始化的时间提前一点.
3.在配置的时候,使用`load-on-start`元素来指定,给定的数字越小,启动的时机就越早,一般不写负数,从2开始即可.

```xml
       <servlet>
             <servlet-name>HelloServlet</servlet-name>
             <servlet-class>com.firstweb.HelloServelet</servlet-class>
             <load-on-startup>2</load-on-startup>
        </servlet>
```

## ServletConfig

```java
    //1.得到servlet配置对象,专门用于在配置servlet的信息
    ServletConfig config = getServletConfig();
    
          //获取道德是配置servlet里面的servlet-name的文本内容
          String servletName = config.getServeletName();
          System.out.println("servletName=" + servletName);
    
    //2.可以获取具体的某一个参数
    String address = config.getInitParameter("address");
    System.out.println("address=" + address);
    
    //3.获取所有参数的名称
    Enumeration<String> names = config.getInitParameterNames();
          //遍历所有的参数名称
          while(name.hashMoreElements()){
                  String key = (String) names.nextElement();
                  String value = config.getInitParameter(key);
                  System.out.println("key=" + key + " value=" + value);  
          }  
```

> 使用他人开发的servlet,如果刚好这个servlet里面需要一个数字或者变量,我们在注册servlet时,需要在web.xml里生命init-params.

##  HttpServletRequest和HttpServletResponse

### Servlet配置方式

* 1.全路径匹配

  * 以 / 开始  /a /aa/bb

  * localhost:8080/项目名称/aa/bb

* 2.路径匹配,前半段匹配

  * 以 / 开始,以 * 结束  /a/*

  * \*其实时一个配符,匹配任意文字

  * localhost:8080/项目名称/*

* 3.以扩展名匹配

  * 写法: /\*.扩展名  /\*.aa   /\*.bb 
  

## ServletContext
* Servlet 上下文

> 每个java虚拟机中的每个web工程只有一个ServletContext对象

### ServletContxet的作用
1.可以获取全局变量
2.可以获取web应用中的资源
3.存取数据，servlet间共享数据 域对象

#### 可以获取全局变量
* 声明
```xml
        <context-param>
                <param-name>address</param-name>
                <param-name>北京</param-name>
        </context-param>
```
* 获取
```java
      //强制类型转换
      String address = (String)getServletContext().getInitParameter("address");

      ServeletContext context = getServletContext();
      String address = context.getInitParameter("address");
```
#### 可以获取web应用中的资源

* 获取资源在tomcat里面的绝对路径
  * 到的是项目在tomcat里面的根目录<br>
 `ontext.getRealpath("");`
  * 这里得到的是文件的绝对路径<br>
`String path = context.getRealPath("file/config.properties");`
 ```java
 //1.ServletContext对象
 ServletContext context = getServletContext();
 //获取给定文件在服务器上的绝对路径
 String path = context.getRealPath("file/config.properties");
 
 //2创建属性对象
 Properties properties = new Properties();
 InputStream is = new FileInputStream(path);
 properties.load(is);
 
 //3.获取name属性的值
 String naem = properties.getProperty("name");
 ```
 
 * getResourceAsStream获取资源流对象
 
  ![icon](https://github.com/WuDeluan/Notes/blob/master/picture/servlet3.PNG)
 
 * 根据classloader去获取工程下的资源 加载器(JDBC)
 
  ![icon](https://github.com/WuDeluan/Notes/blob/master/picture/servlet4.PNG)

#### 存取数据，servlet间共享数据 域对象

![icon](https://github.com/WuDeluan/Notes/blob/master/picture/servlet5.PNG)
 
1.定义一个html页面，定义一个form表单
```html
login.html

      <body>
           <h2>请输入以下内容，完成登录</h2>

            <form action="LoginServlet" method="get">
                账号: <input type="text" name="username"/><br> 
                密码: <input type="password" name="password"/><br>
                <input type="submit" value="登录"/>
            </form>

      </body>
```

* 细节处理 
 ```html
          <!--      A路径：Servlet的路径： -->
          <!--             http:localhost:8080/Demo04/LoginServlet -->
          <!--      B路径：当前这个html的路径 -->
          <!--              http:localhost:8080/Demo04/login.html -->
          
           <!-- 所以action的值为servlet的路径 -->
           <form action="LoginServlet" method="get">
           
            <!-- 也可以写绝对路径路径 -->
            <form action="/Demo04/LoginServlet" method="get">
 ```
2.定义一个Servlet,名为LoginServlet
```java

LoginServlet.java

      protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        //1.获取数据
        String userName = request.getParameter("username");
        String password = request.getParameter("password");

        //2.校验数据
       }
 ```
3.针对成功或者失败，进行判断，然后跳转新页面
```java
LoginServlet.java

     protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
       //1.获取数据
       String userName = request.getParameter("username");
       String password = request.getParameter("password");

       //2.校验数据

       //向客户端输出内容
       PrintWriter pw = response.getWriter();

       if("admin".equals(userName) && "123".equals(password)){
        //跳转到成功得界面
       
        //设置状态码 重新定位 状态码
        response.setStatus(302);
        //定位跳转到得页面
        response.setHeader("Location", "login_success.html");
       }
       else{
        pw.write("login failed!");
       }
      }
```
4.统计成功登录次数
```java
       if("admin".equals(userName) && "123".equals(password)){
          //1.成功的次数累加

          //获取以前的数据，在旧值得基础上加1
          Object obj = getServletContext().getAttribute("count");
          //默认就是0
          int totalCount = 0;
          if(obj != null) {
           totalCount = (int)obj;
          }
          //累加
          getServletContext().setAttribute("count", totalCount + 1);


            //2.跳转到成功得界面
          }

   ```
   
   5.在界面上显示成功登录数量
   ![icon](https://github.com/WuDeluan/Notes/blob/master/picture/servlet6.PNG)
   
   ### Servlet何时创建，何时销毁
   创建：服务器启动的时候,会为托管得每一个web应用程序创建一个servletContext对象。
   销毁：从服务器移除托管，或者是关闭服务器。
   * ServletContext 的作用范围
   > 只要在这个项目里面都可以取数据
   
   ## HttpServletRequest
   
   > 这个对象
   
